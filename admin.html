<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Repair Admin Dashboard</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
    <link rel="stylesheet" href="admin-style.css">

</head>
<body>
    <div id="admin-password-overlay">
        <div class="password-box">
            <h2>Admin Login</h2>
            <input type="password" id="admin-password-input" placeholder="Enter Admin Password" autocomplete="off">
            <button id="admin-password-submit">Login</button>
            <p id="admin-password-message"></p>
        </div>
    </div>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Loading data...</p>
    </div>

    <!-- Developer Signature -->
    <div class="developer-signature">
        <span class="dev-text">Developed by</span> <span class="name-text">DANIIL RITENKO</span>
    </div>

    <div class="container" style="display: none;">
        <h1>Machine Repair Log</h1>
        <div class="controls">
            <button class="button" id="refreshData" title="Refresh Logs">
  üîÑ Refresh
</button>
<button class="button" id="downloadCsv" title="Download as CSV">
  ‚¨áÔ∏è CSV
</button>
            
            
        </div>
        <div class="custom-search-bar">
            <div>
                <label for="search-machine">Machine #:</label>
                <input type="text" id="search-machine" placeholder="Enter machine number">
            </div>

            <div>
                <label for="search-day">Date:</label>
                <input type="date" id="search-day">
            </div>

            <div>
                <label for="search-mechanic">Mechanic:</label>
                <input type="text" id="search-mechanic" placeholder="Mechanic name">
            </div>

            <div>
                <label for="search-issue">Issue:</label>
                <input type="text" id="search-issue" placeholder="Issue keyword">
            </div>

            <div>
                <label for="search-shift">Shift:</label>
                <select id="search-shift">
                    <option value="">All</option>
                    <option value="Green Day">Green Day</option>
                    <option value="Green Night">Green Night</option>
                    <option value="Blue Day">Blue Day</option>
                    <option value="Blue Night">Blue Night</option>
                </select>
            </div>
        </div>
        
        
        <p id="loading-message" style="margin-bottom: 10px; font-weight: bold;"></p>

        <div class="table-responsive">
            <table id="repair-data-table" class="display">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Analytics Dashboard -->
        <div class="analytics-dashboard">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Most Active Mechanics</h3>
                    <div id="most-active-mechanics" class="analytics-content">
                        <div class="loading-spinner">Loading...</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Most Reported Problems</h3>
                    <div id="most-reported-problems" class="analytics-content">
                        <div class="loading-spinner">Loading...</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Log Submits Per Day</h3>
                    <div id="logs-per-day" class="analytics-content">
                        <div class="loading-spinner">Loading...</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Machines With Most Logs</h3>
                    <div id="machines-most-logs" class="analytics-content">
                        <div class="loading-spinner">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Analytics Modal -->
    <div id="analytics-modal" class="analytics-modal">
        <div class="analytics-modal-content">
            <div class="analytics-modal-header">
                <h2 id="modal-title" class="analytics-modal-title">Analytics Details</h2>
                <span class="analytics-close">&times;</span>
            </div>
            <div id="modal-time-selector" class="analytics-time-selector">
                <!-- Time period selector will be placed here -->
            </div>
            <div id="modal-chart" class="analytics-chart-container">
                Chart will be displayed here
            </div>
            <div id="modal-details" class="analytics-details">
                <!-- Detailed analytics will be populated here -->
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, doc, getDoc, getDocs, query, orderBy, where, startAt, endAt } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAdc9STb-EImui0DGhuteY8okGKWAMnpJE",
    authDomain: "machinerepairlogsapp.firebaseapp.com",
    projectId: "machinerepairlogsapp",
    storageBucket: "machinerepairlogsapp.firebasestorage.app",
    messagingSenderId: "933593286710",
    appId: "1:933593286710:web:b257aa07e4a2a7d0cc7097",
    measurementId: "G-BXNYDQ56KC"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Make db and Firestore functions globally accessible (for admin-script.js)
  window.db = db;
  window.collection = collection;
  window.doc = doc;         // <-- ADD THIS
  window.getDoc = getDoc;   // <-- ADD THIS
  window.getDocs = getDocs;
  window.query = query;
  window.orderBy = orderBy;
  window.where = where;
  window.startAt = startAt;
  window.endAt = endAt;
</script>

    <script src="admin-script.js"></script>

</body>
</html>